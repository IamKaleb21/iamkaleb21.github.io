---
import { Icon } from 'astro-icon/components';
import LaptopModel from './LaptopModel';
import { siteData, type SiteData } from '../data/site';

interface Props {
	name?: string;
	subtitle?: string;
	tagline?: string;
	socialLinks?: SiteData['socialLinks'];
}

const { 
	name = siteData.name,
	subtitle = siteData.subtitle,
	tagline = siteData.tagline,
	socialLinks = siteData.socialLinks
} = Astro.props;
---

<header class="hero-section relative py-20 text-center overflow-hidden" data-animate="hero">
	<!-- 3D Laptop como fondo (detrás del contenido) -->
	<div class="laptop-3d-wrapper" data-hero-laptop>
		<LaptopModel client:load />
	</div>

	<!-- Contenido del Hero (encima del laptop) -->
	<div class="hero-content relative z-10">
		<!-- Decorative Grid Lines for the Hero Box -->
		<div class="grid-line-x top-0 w-3/4 mx-auto left-0 right-0"></div>
		<div class="grid-line-x bottom-0 w-3/4 mx-auto left-0 right-0"></div>
		<div class="grid-line-y left-10 h-full opacity-20 hidden md:block"></div>
		<div class="grid-line-y right-10 h-full opacity-20 hidden md:block"></div>
		
		<!-- X markers -->
		<div class="absolute top-[-6px] left-[12%] text-gray-700 text-xs">
			<Icon name="mdi:close" class="w-3 h-3" />
		</div>
		<div class="absolute top-[-6px] right-[12%] text-gray-700 text-xs">
			<Icon name="mdi:close" class="w-3 h-3" />
		</div>

		<!-- Capa de blur entre modelo y texto (elemento real para que el backdrop incluya el Canvas) -->
		<div class="hero-card-wrapper">
			<div class="hero-blur-layer" aria-hidden="true"></div>
			<div class="hero-text-pedestal">
			<p class="text-sm uppercase tracking-[0.2em] text-gray-500 mb-6">Portafolio de</p>
			<h1 class="text-7xl md:text-8xl font-bold font-mono text-white mb-4 tracking-tight flex items-center justify-center" data-hero-title>
				{name}<span class="cursor-vertical"></span>
			</h1>
			<h2 class="text-xl text-gray-400 font-medium mb-2" data-hero-subtitle>{subtitle}</h2>
			<p class="text-xs text-gray-600 uppercase tracking-widest mb-8">{tagline}</p>
			</div>
			<!-- Social Icons -->
		<div class="flex justify-center gap-6 mb-20" data-hero-icons>
			<a href={socialLinks.github} class="text-gray-400 hover:text-white transition-colors text-xl">
				<Icon name="simple-icons:github" class="w-6 h-6" />
			</a>
			<a href={socialLinks.linkedin} class="text-gray-400 hover:text-white transition-colors text-xl">
				<Icon name="simple-icons:linkedin" class="w-6 h-6" />
			</a>
			<a href={socialLinks.email} class="text-gray-400 hover:text-white transition-colors text-xl">
				<Icon name="mdi:email" class="w-6 h-6" />
			</a>
			<a href={socialLinks.website} class="text-gray-400 hover:text-white transition-colors text-xl">
				<Icon name="mdi:web" class="w-6 h-6" />
			</a>
		</div>
		</div>

	</div>
</header>

<style>
	.hero-section {
		min-height: 85vh;
		/* Un solo contexto de apilado para que el backdrop-filter vea el Canvas */
		isolation: isolate;
	}

	/* Wrapper de la card: blur + texto en capas separadas para que el blur sí desenfoque el modelo */
	.hero-card-wrapper {
		position: relative;
		display: inline-block;
	}

	.hero-blur-layer {
		position: absolute;
		inset: 0;
		z-index: -1;
		pointer-events: none;
		border-radius: 1rem;
		background: rgba(3, 5, 12, 0.5);
		-webkit-backdrop-filter: blur(40px);
		backdrop-filter: blur(40px);
		mask-image: radial-gradient(
			ellipse 55% 100% at 50% 50%,
			black 15%,
			transparent 70%
		);
		-webkit-mask-image: radial-gradient(
			ellipse 55% 100% at 50% 50%,
			black 15%,
			transparent 70%
		);
		mask-size: 100% 100%;
		mask-position: center;
		-webkit-mask-size: 100% 100%;
		-webkit-mask-position: center;
	}

	/* Laptop detrás del hero, mismo tamaño que antes */
	.laptop-3d-wrapper {
		position: absolute;
		inset: 0;
		z-index: 0;
		pointer-events: none;
	}

	.laptop-3d-wrapper :global(.laptop-container) {
		width: 100%;
		height: 100%;
		min-height: 500px;
		animation: laptopFadeIn 1.6s ease-out forwards;
	}

	@keyframes laptopFadeIn {
		from { opacity: 0; }
		to   { opacity: 1; }
	}

	.hero-content {
		pointer-events: auto;
	}

	/* Pedestal: solo texto; el blur está en .hero-blur-layer para que desenfoque el modelo */
	.hero-text-pedestal {
		position: relative;
		display: inline-block;
		padding: 1.5rem 2.5rem 2rem;
		margin-bottom: 0.5rem;
		border-radius: 1rem;
	}

	/* Mobile responsive */
	@media (max-width: 768px) {
		.laptop-3d-wrapper :global(.laptop-container) {
			min-height: 400px;
		}
		.hero-blur-layer {
			border-radius: 0.75rem;
		}
		.hero-text-pedestal {
			padding: 1rem 1.25rem 1.5rem;
			border-radius: 0.75rem;
		}
	}

	.cursor-vertical {
		display: inline-block;
		width: 3px;
		height: 0.9em;
		background-color: #a855f7; /* purple-500 */
		margin-left: 0.2rem;
		vertical-align: middle;
		border-radius: 99px;
		animation: cursorExpand 1.5s ease-in-out infinite;
		transform-origin: center;
	}

	@keyframes cursorExpand {
		0%, 100% { 
			transform: scaleY(0);
		}
		50% { 
			transform: scaleY(1);
		}
	}
</style>
